// Global variable declaration

// JSON for hyperspectral data
hsdataset = {};
hsdataset.crs = 'http://kahlua.eecs.jacobs-university.de:8080/def/crs/PS/0/2/';
hsdataset.prj = 'GEOGCS["GCS_Mars_2000_Sphere",DATUM["D_Mars_2000_sphere",SPHEROID["Mars_2000_Sphere",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]';
hsdataset.productid = "";
hsdataset.point = []; // saves data of the clicked locations for query map features
hsdataset.mapoptions = {   
    opacity: 1,
    isBaseLayer: false,
    numZoomLevels : 20,
    isVisible: true,
    displayOutsideMaxExtent: true,
    wrapDateLine: true,
    alwaysInRange: true,
    displayInLayerSwitcher: false
};

// JSON for hyperspectral data - NEW OBJECTS
// IR object
hsdataset.ir = {};
hsdataset.ir.crs = 'http://kahlua.eecs.jacobs-university.de:8080/def/crs/PS/0/1/';
hsdataset.ir.prj = 'GEOGCS["GCS_Mars_2000_Sphere",DATUM["D_Mars_2000_sphere",SPHEROID["Mars_2000_Sphere",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]';
hsdataset.ir.productid = "";
hsdataset.ir.point = []; // saves data of the clicked locations for query map features
hsdataset.ir.mapoptions = {   
    opacity: 1,
    isBaseLayer: false,
    numZoomLevels : 20,
    isVisible: true,
    displayOutsideMaxExtent: true,
    wrapDateLine: true,
    alwaysInRange: true,
    displayInLayerSwitcher: false
};

// VNIR object
hsdataset.vnir = {};
hsdataset.vnir.crs = 'http://kahlua.eecs.jacobs-university.de:8080/def/crs/PS/0/1/';
hsdataset.vnir.prj = 'GEOGCS["GCS_Mars_2000_Sphere",DATUM["D_Mars_2000_sphere",SPHEROID["Mars_2000_Sphere",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]';
hsdataset.vnir.productid = "";
hsdataset.vnir.point = []; // saves data of the clicked locations for query map features
hsdataset.vnir.mapoptions = {   
    opacity: 1,
    isBaseLayer: false,
    numZoomLevels : 20,
    isVisible: true,
    displayOutsideMaxExtent: true,
    wrapDateLine: true,
    alwaysInRange: true,
    displayInLayerSwitcher: false
};

// JSON for default 'moladtm' global elevation dataset in rasdaman
dtmdefault = {}
dtmdefault.collection = 'moladtm';
dtmdefault.crs = 'http://kahlua.eecs.jacobs-university.de:8080/def/crs/PS/0/1/';
dtmdefault.xmin = -180;
dtmdefault.xmax = 180;
dtmdefault.ymin = -88;
dtmdefault.ymax = 88;
dtmdefault.width = 46080;
dtmdefault.height = 22528;

//MRDR
var mrdr = {
    'T0667_MRRIF_20S043_0256_3':
        {'name': 'T0667_MRRIF_20S043_0256_3',
        'westernlon': 40,
        'easternlon': 45,
        'minlat': -22.5,
        'maxlat': -17.5,
        'wms': {'name': 'CTX of T0667_MRRIF_20S043_0256_3',
            'map': '/var/lib/pgsql/process_data/wms/noachis/T0667_MRRIF_20S043_0256_3.map',
            'layer': 'T0667_MRRIF_20S043_0256_3',
            'projection': 'PS:2'}},
    'T0666_MRRIF_20S038_0256_3':
        {'name': 'T0666_MRRIF_20S038_0256_3',
        'westernlon': 35,
        'easternlon': 40,
        'minlat': -22.5,
        'maxlat': -17.5,
        'wms': {'name': 'CTX of T0666_MRRIF_20S038_0256_3',
            'map': '/var/lib/pgsql/process_data/wms/noachis/T0666_MRRIF_20S038_0256_3.map',
            'layer': 'T0666_MRRIF_20S038_0256_3',
            'projection': 'PS:2'}},
    };

// Regions
var regions = {
    'gale': 
        {'id': 'gale',
        'name': 'Gale crater',
        'westernlon': 135.5,
        'easternlon': 140,
        'minlat': -7.5,
        'maxlat': -3,
	'thumbnail': 'Gale.jpg',
        'wms': [
            {'name': 'Gale HRSC mosaic',
            'map': '/var/lib/pgsql/process_data/wms/gale/galehrsc.map',
            'layer': 'galehrsc',
            'projection': 'PS:1'},
            {'name': 'Gale CTX mosaic',
            'map': '/var/lib/pgsql/process_data/wms/gale/galectx.map',
            'layer': 'galectx',
            'projection': 'PS:1'}],
        'dtm': [
            {'collection': 'galehrscdtm',
            'name': 'Gale HRSC DTM'}]
        },
    'ganges':
        {'id': 'ganges',
        'name': 'Ganges Chasma',
        'westernlon': -55,
        'easternlon': -40,
        'minlat': -11,
        'maxlat': -5.5,
	'thumbnail': 'Ganges.jpg',
        'wms':[],
        'dtm':[
            {'collection': 'gangeshrscdtm',
            'name': 'Ganges HRSC DTM'}]},
    'capri':
        {'id': 'capri',
        'name': 'Capri Chasma',
        'westernlon': -58,
        'easternlon': -36,
        'minlat': -18.5,
        'maxlat': -10,
	'thumbnail': 'Capri.jpg',
        'wms':[],
        'dtm':[]},
    'juventae':
        {'id': 'juventae',
        'name': 'Juventae Chasma',
        'westernlon': -64,
        'easternlon': -59,
        'minlat': -6,
        'maxlat': -0.5,
	'thumbnail': 'Juventae.jpg',
        'wms':[],
        'dtm':[]},
    'mawrth':
        {'id': 'mawrth',
        'name': 'Marwth Vallis',
        'westernlon': -30,
        'easternlon': -14,
        'minlat': 19,
        'maxlat': 28,
	'thumbnail': 'Marwth.jpg',
        'wms':[],
        'dtm':[]},
    'nili':
        {'id': 'nili',
        'name': 'Nili Fossae',
        'westernlon': 70,
        'easternlon': 82,
        'minlat': 16,
        'maxlat': 30,
	'thumbnail': 'Nili.jpg',
        'wms':[],
        'dtm':[]}
};

// JSON for currently loaded elevation dataset, default 'moladtm'.
dtmdataset = {}
dtmdataset = jQuery.extend({}, dtmdefault);

// Changing variables
var WMSlayers = [];
var PNGimages = [];
var imagedata = [];
var diagramplot = {};
var hist;
var spectra;
var cross;
var pos = 0; // position to be used for adding data in query map features
var full = 0; // a boolean variable to track if all the dataset.point[]'s are filled
var turn = 0; // A global variable to keep track of turns for finding spectral ratio
var crossturn = 0;
var rgb = 0;

// User changable variables. These can later be added to a properties/settings window.
var nrpoints = 100;
var binvalue = 3; //spectrum binning, default 3x3
var maxbin = 7;
var nrclicks = 10; // nrclicks and nr of colors need to be the same
var colors = [ "Red", "Green", "Blue", "#6500bb", "Magenta", "Pink", "Gray", "Brown", "Orange", "Yellow"];
var pointsize = 0.0024;
var minstretch = 0;
var maxstretch = 0;
var filename = "image";

// Fixed variables
var planetserver_path = "http://planetserver.jacobs-university.de/";
//var planetserver_path = "";
var planetserver_ps_wms = "http://planetserver.jacobs-university.de:8080/petascope/wms";
var planetserver_ms_wms = "http://planetserver.jacobs-university.de/cgi-bin/mapserv";
var planetserver_wcps = "http://planetserver.jacobs-university.de:8080/petascope";
var planetserver_wcsdc = "http://planetserver.jacobs-university.de:8080/petascope/wcs?version=2.0.0&service=WCS&request=DescribeCoverage&coverageId=";

Proj4js.defs["PS:1"] = "+proj=longlat +a=3396190 +b=3396190 +no_defs";
Proj4js.defs["ODE"] = "+proj=longlat +a=3396190 +b=3396190 +lon_wrap=180 +no_defs";
//Proj4js.defs["EPSG:4326"] = "+proj=longlat +a=3396190 +b=3396190 +no_defs";
Proj4js.defs["PS:2?0"] = "+proj=eqc +lat_ts=0 +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +a=3396190 +b=3396190 +units=m +no_defs";
Proj4js.defs["PS:2?180"] = "+proj=eqc +lat_ts=0 +lat_0=0 +lon_0=180 +x_0=0 +y_0=0 +a=3396190 +b=3396190 +units=m +no_defs";
//Proj4js.reportError = function(msg) {alert(msg);}


// These variables are part of the rasdaman collection name. For example:
// When querying ODE REST you get:
// productid = frt00009ca9_07_if164l_trr3
// Then you know that:
// collection = productid + "_" + pcversion + "_" + ptversion
// How to deal with these version numbers, where to store them, still needs to be decided.
var pcversion = "1"; // PlanetServer processing chain version
var ptversion = "01"; // PlanetServer processing type version


// ExtJS's global vars
var winChoiceVNIR;
var winTutorial;
var winAbout;
var winToc;
var winDiagrams;
var winWebsearch;
var winConsole;
var usedCrism = 1;	// 0 = IR; 1 = VNIR
//var dataTocEmpty = true;

// Other global vars
var footprints;
var curiosity;
// Set index at max for vectorDraw layer (vectorDraw layer stay ever on top)
var VECTORDRAW_INDEX = 99;
// Z-index value for layers
var SETZINDEX = 1200; 